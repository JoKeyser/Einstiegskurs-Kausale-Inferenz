---
title: "Modul 01: An der Weggabelung: Einen Weg gehen - und einen nicht"
output: 
  learnr::tutorial:
    progressive: true
    css: "css/style.css"
runtime: shiny_prerendered
---


```{r setup, include=FALSE}
library(learnr)
library(mosaic)
library(knitr)

# Daten simulieren
set.seed(1896)
n <- 10

Schulung <- tibble(finteresse = rnorm(n)) %>%
  rowwise() %>%
  mutate(pteilnahme = pnorm((finteresse+rnorm(1)))) %>%
  mutate(teilnahme = sample(c("Ja", "Nein"), 
                            size = 1, prob = c(pteilnahme, 1-pteilnahme))) %>%
  mutate(gehalt0 = 2000 * (1 + pnorm((finteresse + rnorm(1)))/10)) %>%
  mutate(gehalt1 = gehalt0 * (1 + rbeta(1,1,10))) %>%
  mutate(effekt = gehalt1 - gehalt0) %>%
  mutate(gehalt = case_when(teilnahme == "Ja" ~ gehalt1,
                            teilnahme == "Nein" ~ gehalt0)) %>%
  mutate(across(where(is.numeric), ~ round(.x,2))) %>%
  ungroup() %>%
  mutate(i=row_number()) %>%
  select(i, teilnahme, gehalt0, gehalt1, effekt, gehalt)
```

## Lernziele

In diesem Modul lernen Sie:

- Was ein *Potential Outcome* ist.

- Was ein *Counterfactual* ist.

- Wie *Kausale Effekte* definiert werden können.

- Warum die Bestimmung von kausalen Effekten so herausfordernd ist.

## Individueller Kausaler Effekt

Stellen Sie sich folgende Situation vor: Am Ende der Ausbildungszeit wird eine freiwillige Schulung zum Thema Gehaltsverhandlungen angeboten.

Würden Sie teilnehmen?

Und wie würden Sie für sich den **Individuellen Kausalen Effekt** der Teilnahme an der Schulung auf Ihr Gehalt definieren. D.&#8239;h., die Frage ist wie viel höher Ihr Gehalt aufgrund der Schulung ist.

*Denken Sie bitte kurz darüber nach und klicken Sie erst dann auf `Next Topic`*

##

Manche antworten hier vielleicht *Gehalt nach der Schulung minus Gehalt vor der Schulung*. Aber das ist es nicht wirklich. Vielleicht hätte sich ja auch ohne die Teilnahme an der Schulung Ihr Gehalt erhöht. So wie manche Krankheiten mit oder ohne Behandlung verschwinden.

Eine andere Möglichkeit ist es, diesen Effekt als 

$$\text{Gehalt mit Schulung} - \text{Gehalt ohne Schulung} $$

zu definieren.

Wenn Sie vor der Entscheidung stehen: *Nehme ich an der Schulung teil?* gibt es für Ihr Gehalt zwei **potenzielle Ergebnisse** (engl.: Potential Outcomes):

- Gehalt mit Schulung
 
- Gehalt ohne Schulung.

Mathematisch dargestellt:

$$\color{purple}{Y}^{\color{olive}{X=1}}_i - \color{purple}{Y}^{\color{olive}{X=0}}_i$$

Wobei

- $i$ für die einzelne Beobachtung, hier die einzelne Person steht

- $\color{purple}{Y}_i$ für das Gehalt von $i$

- $\color{olive}{X}$ für die Teilnahme an der Schulung; dabei ist $\color{olive}{X_i=1}$ wenn $i$ teilnimmt und  $\color{olive}{X_i=0}$ wenn $i$ nicht teilnimmt.

Damit ergibt sich der **individuelle kausale Effekt** $\color{blue}{\Delta}_i$ der Teilnahme als:

$$\color{blue}{\Delta}_i = \color{purple}{Y}^{\color{olive}{X=1}}_i - \color{purple}{Y}^{\color{olive}{X=0}}_i$$

## Ein fiktives Beispiel

Schauen wir uns einmal eine fiktive Gehaltstabelle von Potential Outcomes an:

- `i`: Laufende Nummer der Beobachtung.

- `gehalt1`: $\color{purple}{Y}^{\color{olive}{X=1}}$, Gehalt mit Schulung

- `gehalt0`: $\color{purple}{Y}^{\color{olive}{X=1}}$, Gehalt ohne Schulung

```{r gehaltstabelle, echo=FALSE}
Schulung %>%
  select(i, gehalt1, gehalt0) %>%
  kable()
```


Der individuelle kausale Effekt $\color{blue}{\Delta}_i$ lässt sich dann in `R` innerhalb der Datentabelle `Schulung` berechnen als `gehalt1 - gehalt0`:

```{r}
Schulung <- Schulung %>%
  mutate(effekt = gehalt1 - gehalt0)
```

Und damit:

```{r gehaltstabelleeffekt, echo=FALSE}
Schulung %>%
  select(i, gehalt1, gehalt0, effekt) %>%
  kable()
```


```{r ike, echo=FALSE}
question("Lässt sich der individuelle kausale Effekt in der Praxis beobachten?",
         answer("Ja", message = "Je Beobachtung $i$ liegt nur ein Wert vor: Der mit Schulung oder der ohne Schulung, nicht beide gleichzeitig. $\\Delta_i$ kann nicht beobachtet werden."),
         answer("Nein", correct = TRUE, message = "Je Beobachtung $i$ liegt nur ein Wert vor: Der mit Schulung oder der ohne Schulung, nicht beide gleichzeitig. $\\Delta_i$ kann nicht beobachtet werden.")
         )
```

## Das fundamentale Problem der kausalen Inferenz

